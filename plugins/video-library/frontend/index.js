(function(n,j,l,h){"use strict";var m={exports:{}},g={};var w;function $(){if(w)return g;w=1;var r=Symbol.for("react.transitional.element"),s=Symbol.for("react.fragment");function o(c,a,d){var u=null;if(d!==void 0&&(u=""+d),a.key!==void 0&&(u=""+a.key),"key"in a){d={};for(var p in a)p!=="key"&&(d[p]=a[p])}else d=a;return a=d.ref,{$$typeof:r,type:c,key:u,ref:a!==void 0?a:null,props:d}}return g.Fragment=s,g.jsx=o,g.jsxs=o,g}var E;function F(){return E||(E=1,m.exports=$()),m.exports}var e=F();const I=({urls:r})=>{const s=n.useRef(null);return n.useEffect(()=>{if(s.current){const o=document.createElement("video");o.src=r.streamUrl||r.downloadUrl,o.controls=!0,o.autoplay=!0,o.style.width="100%",o.style.height="100%",o.style.backgroundColor="#000",s.current.innerHTML="",s.current.appendChild(o)}},[r]),e.jsx("div",{ref:s,style:{width:"100%",height:"100%",backgroundColor:"#000"}})},O="https://image.tmdb.org/t/p/";function _(r,s){if(r)return`${O}${s}${r}`}const{foxelApi:T}=window.__FOXEL_EXTERNALS__;function S(r){if(r&&typeof r=="object"&&"code"in r){const{code:s,data:o,detail:c,message:a}=r;if(s!==0)throw new Error(c||a||"请求失败");return o}return r}async function X(){const r=await T.request("/plugins/video-library/library"),s=S(r);return Array.isArray(s)?s:[]}async function D(r){const s=await T.request(`/plugins/video-library/library/${r}`);return S(s)}const M=()=>{const{token:r}=l.theme.useToken(),[s,o]=n.useState(""),[c,a]=n.useState("all"),[d,u]=n.useState([]),[p,k]=n.useState(!1),[q,C]=n.useState(!1),[z,L]=n.useState(null),[B,A]=n.useState(!1),[x,f]=n.useState(null),v=n.useCallback(async()=>{k(!0);try{const t=await X();u(t||[])}catch(t){u([]),l.message.error(t?.message||"加载失败")}finally{k(!1)}},[]);n.useEffect(()=>{v()},[v]);const b=n.useMemo(()=>{let t=0,i=0;return d.forEach(y=>{y.type==="tv"&&(t+=1),y.type==="movie"&&(i+=1)}),{total:d.length,tv:t,movie:i}},[d]),R=n.useMemo(()=>{const t=s.trim().toLowerCase();return d.filter(i=>c!=="all"&&i.type!==c?!1:t?`${i.title||""} ${i.overview||""} ${(i.genres||[]).join(" ")}`.toLowerCase().includes(t):!0)},[c,d,s]),N=n.useCallback(async t=>{A(!0),f(null);try{const i=await D(t.id);f(i)}catch(i){f(null),l.message.error(i?.message||"加载失败")}finally{A(!1)}},[]),P=t=>{L(t),C(!0),N(t)},J=()=>{C(!1),L(null),f(null)},V=t=>{const i=t.type==="tv"?"TV":"Movie",y=_(t.poster_path,"w342")||_(t.backdrop_path,"w780");return e.jsxs("div",{style:{position:"relative",width:"100%",aspectRatio:"2 / 3",background:"linear-gradient(135deg, #0b1020 0%, #22314a 55%, #2b3b5c 100%)",overflow:"hidden"},children:[y?e.jsx(l.Image,{src:y,alt:t.title||i,preview:!1,wrapperStyle:{width:"100%",height:"100%",display:"block"},style:{width:"100%",height:"100%",objectFit:"cover",display:"block"},fallback:"/logo.svg"}):e.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",color:"rgba(255,255,255,0.7)"},children:e.jsx(h.VideoCameraOutlined,{style:{fontSize:28}})}),e.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(180deg, rgba(0,0,0,0.48) 0%, rgba(0,0,0,0.12) 40%, rgba(0,0,0,0.45) 100%)",pointerEvents:"none"}}),e.jsxs("div",{style:{position:"absolute",top:10,left:10,right:10,display:"flex",justifyContent:"space-between",alignItems:"center",gap:8,pointerEvents:"none"},children:[e.jsx(l.Tag,{color:t.type==="tv"?"geekblue":"gold",style:{marginInlineEnd:0},children:i}),e.jsx(h.VideoCameraOutlined,{style:{fontSize:18,opacity:.9,color:"rgba(255,255,255,0.9)"}})]}),e.jsx("div",{style:{position:"absolute",left:10,bottom:10,width:36,height:36,borderRadius:999,background:"rgba(2,6,23,0.55)",border:"1px solid rgba(255,255,255,0.22)",display:"flex",alignItems:"center",justifyContent:"center",color:"rgba(255,255,255,0.92)",boxShadow:r.boxShadowTertiary,pointerEvents:"none"},children:e.jsx(h.PlayCircleOutlined,{style:{fontSize:20}})})]})};return e.jsxs("div",{style:{height:"100%",display:"flex",flexDirection:"column",background:r.colorBgLayout},children:[e.jsx("div",{style:{padding:14,borderRadius:12,background:r.colorBgContainer,border:`1px solid ${r.colorBorderSecondary}`},children:e.jsxs(l.Flex,{align:"center",justify:"space-between",gap:12,wrap:!0,children:[e.jsxs("div",{style:{minWidth:240},children:[e.jsx(l.Typography.Title,{level:4,style:{margin:0},children:"视频库"}),e.jsx(l.Typography.Text,{type:"secondary",children:`总计: ${b.total} · 电影: ${b.movie} · 电视剧: ${b.tv}`})]}),e.jsxs(l.Space,{size:10,wrap:!0,children:[e.jsx(l.Segmented,{value:c,onChange:t=>a(t),options:[{value:"all",label:"全部"},{value:"movie",label:"电影"},{value:"tv",label:"电视剧"}]}),e.jsx(l.Input,{allowClear:!0,value:s,onChange:t=>o(t.target.value),prefix:e.jsx(h.SearchOutlined,{}),placeholder:"搜索",style:{width:260}}),e.jsx(l.Button,{icon:e.jsx(h.ReloadOutlined,{}),onClick:v,loading:p,children:"刷新"})]})]})}),e.jsx("div",{style:{flex:1,minHeight:0,overflow:"auto",padding:"12px 2px"},children:p?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(210px, 1fr))",gap:12},children:Array.from({length:10}).map((t,i)=>e.jsx(l.Card,{size:"small",style:{borderRadius:12,overflow:"hidden"},cover:e.jsx("div",{style:{width:"100%",aspectRatio:"2 / 3"},children:e.jsx(l.Skeleton.Image,{active:!0,style:{width:"100%",height:"100%"}})}),children:e.jsx(l.Skeleton,{active:!0,paragraph:{rows:2}})},i))}):R.length===0?e.jsx(l.Empty,{description:"暂无数据",style:{marginTop:48}}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(210px, 1fr))",gap:12},children:R.map(t=>e.jsxs(l.Card,{hoverable:!0,size:"small",styles:{body:{padding:10}},style:{borderRadius:12,overflow:"hidden",boxShadow:r.boxShadowTertiary,border:`1px solid ${r.colorBorderSecondary}`},cover:V(t),onClick:()=>P(t),children:[e.jsx(l.Typography.Text,{strong:!0,ellipsis:!0,style:{display:"block"},children:t.title||"--"}),e.jsxs("div",{style:{marginTop:6,display:"flex",gap:8,color:r.colorTextTertiary,fontSize:12},children:[e.jsx("span",{children:t.year||"--"}),t.type==="tv"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"·"}),e.jsx("span",{children:`${t.episodes_count||0} 集`})]})]}),e.jsxs("div",{style:{marginTop:8,display:"flex",flexWrap:"wrap",gap:6},children:[(t.genres||[]).slice(0,3).map(i=>e.jsx(l.Tag,{style:{marginInlineEnd:0},children:i},i)),(t.genres||[]).length>3&&e.jsx(l.Tag,{style:{marginInlineEnd:0},children:`+${(t.genres||[]).length-3}`})]})]},t.id))})}),e.jsx(l.Drawer,{title:z?.title||"详情",open:q,onClose:J,width:"100%",destroyOnClose:!0,styles:{body:{padding:0}},children:B?e.jsx("div",{style:{padding:16},children:e.jsx(l.Skeleton,{active:!0,paragraph:{rows:10}})}):x?e.jsxs("div",{style:{padding:16},children:[e.jsx(l.Typography.Title,{level:4,children:x.tmdb?.detail?.title||x.tmdb?.detail?.name||"--"}),e.jsx(l.Typography.Paragraph,{children:x.tmdb?.detail?.overview||"暂无简介"})]}):e.jsx(l.Empty,{description:"暂无数据",style:{marginTop:48}})})]})};if(!window.__FOXEL_EXTERNALS__)throw console.error("[video-library] Foxel externals not found"),new Error("Foxel externals not found");window.FoxelRegister({mount:(r,s)=>{const o=j.createRoot(r);return o.render(n.createElement(I,s)),()=>o.unmount()},mountApp:(r,s)=>{const o=j.createRoot(r);return o.render(n.createElement(M,s)),()=>o.unmount()}})})(window.__FOXEL_EXTERNALS__.React,window.__FOXEL_EXTERNALS__.ReactDOM,window.__FOXEL_EXTERNALS__.antd,window.__FOXEL_EXTERNALS__.AntdIcons);
