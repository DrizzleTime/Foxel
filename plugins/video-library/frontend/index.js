(function(n,b,s,h){"use strict";var v={exports:{}},y={};var j;function O(){if(j)return y;j=1;var o=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function i(g,a,d){var c=null;if(d!==void 0&&(c=""+d),a.key!==void 0&&(c=""+a.key),"key"in a){d={};for(var u in a)u!=="key"&&(d[u]=a[u])}else d=a;return a=d.ref,{$$typeof:o,type:g,key:c,ref:a!==void 0?a:null,props:d}}return y.Fragment=r,y.jsx=i,y.jsxs=i,y}var E;function X(){return E||(E=1,v.exports=O()),v.exports}var e=X();const M=({urls:o})=>{const r=n.useRef(null);return n.useEffect(()=>{if(r.current){const i=document.createElement("video");i.src=o.streamUrl||o.downloadUrl,i.controls=!0,i.autoplay=!0,i.style.width="100%",i.style.height="100%",i.style.backgroundColor="#000",r.current.innerHTML="",r.current.appendChild(i)}},[o]),e.jsx("div",{ref:r,style:{width:"100%",height:"100%",backgroundColor:"#000"}})},$="https://image.tmdb.org/t/p/";function _(o,r){if(o)return`${$}${r}${o}`}const{foxelApi:S}=window.__FOXEL_EXTERNALS__;function T(o){if(o&&typeof o=="object"&&"code"in o){const{code:r,data:i,detail:g,message:a}=o;if(r!==0)throw new Error(g||a||"Request failed");return i}return o}async function N(){const o=await S.request("/plugins/video-library/library"),r=T(o);return Array.isArray(r)?r:[]}async function V(o){const r=await S.request(`/plugins/video-library/library/${o}`);return T(r)}const D={"Request failed":"请求失败","Load failed":"加载失败","Video Library":"视频库","Total: {total} · Movies: {movies} · TV Shows: {tvShows}":"总计: {total} · 电影: {movies} · 电视剧: {tvShows}",All:"全部",Movies:"电影","TV Shows":"电视剧",Search:"搜索",Refresh:"刷新","No data":"暂无数据","{count} episodes":"{count} 集",Details:"详情","No overview":"暂无简介",Movie:"电影",TV:"电视剧"},q=window.__FOXEL_EXTERNALS__.i18n,{t:L,useI18n:z}=q.create({zh:D}),B=()=>{const{token:o}=s.theme.useToken(),{t:r}=z(),[i,g]=n.useState(""),[a,d]=n.useState("all"),[c,u]=n.useState([]),[k,C]=n.useState(!1),[P,R]=n.useState(!1),[J,A]=n.useState(null),[U,F]=n.useState(!1),[x,f]=n.useState(null),m=n.useCallback(async()=>{C(!0);try{const t=await N();u(t||[])}catch(t){u([]),s.message.error(L(t?.message||"Load failed"))}finally{C(!1)}},[]);n.useEffect(()=>{m()},[m]);const w=n.useMemo(()=>{let t=0,l=0;return c.forEach(p=>{p.type==="tv"&&(t+=1),p.type==="movie"&&(l+=1)}),{total:c.length,tv:t,movie:l}},[c]),I=n.useMemo(()=>{const t=i.trim().toLowerCase();return c.filter(l=>a!=="all"&&l.type!==a?!1:t?`${l.title||""} ${l.overview||""} ${(l.genres||[]).join(" ")}`.toLowerCase().includes(t):!0)},[a,c,i]),G=n.useCallback(async t=>{F(!0),f(null);try{const l=await V(t.id);f(l)}catch(l){f(null),s.message.error(L(l?.message||"Load failed"))}finally{F(!1)}},[]),H=t=>{A(t),R(!0),G(t)},W=()=>{R(!1),A(null),f(null)},Y=t=>{const l=t.type==="tv"?r("TV"):r("Movie"),p=_(t.poster_path,"w342")||_(t.backdrop_path,"w780");return e.jsxs("div",{style:{position:"relative",width:"100%",aspectRatio:"2 / 3",background:"linear-gradient(135deg, #0b1020 0%, #22314a 55%, #2b3b5c 100%)",overflow:"hidden"},children:[p?e.jsx(s.Image,{src:p,alt:t.title||l,preview:!1,wrapperStyle:{width:"100%",height:"100%",display:"block"},style:{width:"100%",height:"100%",objectFit:"cover",display:"block"},fallback:"/logo.svg"}):e.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",color:"rgba(255,255,255,0.7)"},children:e.jsx(h.VideoCameraOutlined,{style:{fontSize:28}})}),e.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(180deg, rgba(0,0,0,0.48) 0%, rgba(0,0,0,0.12) 40%, rgba(0,0,0,0.45) 100%)",pointerEvents:"none"}}),e.jsxs("div",{style:{position:"absolute",top:10,left:10,right:10,display:"flex",justifyContent:"space-between",alignItems:"center",gap:8,pointerEvents:"none"},children:[e.jsx(s.Tag,{color:t.type==="tv"?"geekblue":"gold",style:{marginInlineEnd:0},children:l}),e.jsx(h.VideoCameraOutlined,{style:{fontSize:18,opacity:.9,color:"rgba(255,255,255,0.9)"}})]}),e.jsx("div",{style:{position:"absolute",left:10,bottom:10,width:36,height:36,borderRadius:999,background:"rgba(2,6,23,0.55)",border:"1px solid rgba(255,255,255,0.22)",display:"flex",alignItems:"center",justifyContent:"center",color:"rgba(255,255,255,0.92)",boxShadow:o.boxShadowTertiary,pointerEvents:"none"},children:e.jsx(h.PlayCircleOutlined,{style:{fontSize:20}})})]})};return e.jsxs("div",{style:{height:"100%",display:"flex",flexDirection:"column",background:o.colorBgLayout},children:[e.jsx("div",{style:{padding:14,borderRadius:12,background:o.colorBgContainer,border:`1px solid ${o.colorBorderSecondary}`},children:e.jsxs(s.Flex,{align:"center",justify:"space-between",gap:12,wrap:!0,children:[e.jsxs("div",{style:{minWidth:240},children:[e.jsx(s.Typography.Title,{level:4,style:{margin:0},children:r("Video Library")}),e.jsx(s.Typography.Text,{type:"secondary",children:r("Total: {total} · Movies: {movies} · TV Shows: {tvShows}",{total:w.total,movies:w.movie,tvShows:w.tv})})]}),e.jsxs(s.Space,{size:10,wrap:!0,children:[e.jsx(s.Segmented,{value:a,onChange:t=>d(t),options:[{value:"all",label:r("All")},{value:"movie",label:r("Movies")},{value:"tv",label:r("TV Shows")}]}),e.jsx(s.Input,{allowClear:!0,value:i,onChange:t=>g(t.target.value),prefix:e.jsx(h.SearchOutlined,{}),placeholder:r("Search"),style:{width:260}}),e.jsx(s.Button,{icon:e.jsx(h.ReloadOutlined,{}),onClick:m,loading:k,children:r("Refresh")})]})]})}),e.jsx("div",{style:{flex:1,minHeight:0,overflow:"auto",padding:"12px 2px"},children:k?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(210px, 1fr))",gap:12},children:Array.from({length:10}).map((t,l)=>e.jsx(s.Card,{size:"small",style:{borderRadius:12,overflow:"hidden"},cover:e.jsx("div",{style:{width:"100%",aspectRatio:"2 / 3"},children:e.jsx(s.Skeleton.Image,{active:!0,style:{width:"100%",height:"100%"}})}),children:e.jsx(s.Skeleton,{active:!0,paragraph:{rows:2}})},l))}):I.length===0?e.jsx(s.Empty,{description:r("No data"),style:{marginTop:48}}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(210px, 1fr))",gap:12},children:I.map(t=>e.jsxs(s.Card,{hoverable:!0,size:"small",styles:{body:{padding:10}},style:{borderRadius:12,overflow:"hidden",boxShadow:o.boxShadowTertiary,border:`1px solid ${o.colorBorderSecondary}`},cover:Y(t),onClick:()=>H(t),children:[e.jsx(s.Typography.Text,{strong:!0,ellipsis:!0,style:{display:"block"},children:t.title||"--"}),e.jsxs("div",{style:{marginTop:6,display:"flex",gap:8,color:o.colorTextTertiary,fontSize:12},children:[e.jsx("span",{children:t.year||"--"}),t.type==="tv"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"·"}),e.jsx("span",{children:r("{count} episodes",{count:t.episodes_count||0})})]})]}),e.jsxs("div",{style:{marginTop:8,display:"flex",flexWrap:"wrap",gap:6},children:[(t.genres||[]).slice(0,3).map(l=>e.jsx(s.Tag,{style:{marginInlineEnd:0},children:l},l)),(t.genres||[]).length>3&&e.jsx(s.Tag,{style:{marginInlineEnd:0},children:`+${(t.genres||[]).length-3}`})]})]},t.id))})}),e.jsx(s.Drawer,{title:J?.title||r("Details"),open:P,onClose:W,width:"100%",destroyOnClose:!0,styles:{body:{padding:0}},children:U?e.jsx("div",{style:{padding:16},children:e.jsx(s.Skeleton,{active:!0,paragraph:{rows:10}})}):x?e.jsxs("div",{style:{padding:16},children:[e.jsx(s.Typography.Title,{level:4,children:x.tmdb?.detail?.title||x.tmdb?.detail?.name||"--"}),e.jsx(s.Typography.Paragraph,{children:x.tmdb?.detail?.overview||r("No overview")})]}):e.jsx(s.Empty,{description:r("No data"),style:{marginTop:48}})})]})};if(!window.__FOXEL_EXTERNALS__)throw console.error("[video-library] Foxel externals not found"),new Error("Foxel externals not found");window.FoxelRegister({mount:(o,r)=>{const i=b.createRoot(o);return i.render(n.createElement(M,r)),()=>i.unmount()},mountApp:(o,r)=>{const i=b.createRoot(o);return i.render(n.createElement(B,r)),()=>i.unmount()}})})(window.__FOXEL_EXTERNALS__.React,window.__FOXEL_EXTERNALS__.ReactDOM,window.__FOXEL_EXTERNALS__.antd,window.__FOXEL_EXTERNALS__.AntdIcons);
