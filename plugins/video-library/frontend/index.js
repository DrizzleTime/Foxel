(function(o,j,r,h){"use strict";var m={exports:{}},x={};var w;function R(){if(w)return x;w=1;var l=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function i(c,d,a){var u=null;if(a!==void 0&&(u=""+a),d.key!==void 0&&(u=""+d.key),"key"in d){a={};for(var p in d)p!=="key"&&(a[p]=d[p])}else a=d;return d=a.ref,{$$typeof:l,type:c,key:u,ref:d!==void 0?d:null,props:a}}return x.Fragment=n,x.jsx=i,x.jsxs=i,x}var E;function $(){return E||(E=1,m.exports=R()),m.exports}var e=$();const F=({urls:l})=>{const n=o.useRef(null);return o.useEffect(()=>{if(n.current){const i=document.createElement("video");i.src=l.streamUrl||l.downloadUrl,i.controls=!0,i.autoplay=!0,i.style.width="100%",i.style.height="100%",i.style.backgroundColor="#000",n.current.innerHTML="",n.current.appendChild(i)}},[l]),e.jsx("div",{ref:n,style:{width:"100%",height:"100%",backgroundColor:"#000"}})},I="https://image.tmdb.org/t/p/";function _(l,n){if(l)return`${I}${n}${l}`}const{foxelApi:T}=window.__FOXEL_EXTERNALS__;async function O(){return await T.request("/plugins/video-library/library")||[]}async function X(l){return await T.request(`/plugins/video-library/library/${l}`)}const D=()=>{const{token:l}=r.theme.useToken(),[n,i]=o.useState(""),[c,d]=o.useState("all"),[a,u]=o.useState([]),[p,S]=o.useState(!1),[M,k]=o.useState(!1),[q,C]=o.useState(null),[z,L]=o.useState(!1),[g,f]=o.useState(null),v=o.useCallback(async()=>{S(!0);try{const t=await O();u(t||[])}catch(t){u([]),r.message.error(t?.message||"加载失败")}finally{S(!1)}},[]);o.useEffect(()=>{v()},[v]);const b=o.useMemo(()=>{let t=0,s=0;return a.forEach(y=>{y.type==="tv"&&(t+=1),y.type==="movie"&&(s+=1)}),{total:a.length,tv:t,movie:s}},[a]),A=o.useMemo(()=>{const t=n.trim().toLowerCase();return a.filter(s=>c!=="all"&&s.type!==c?!1:t?`${s.title||""} ${s.overview||""} ${(s.genres||[]).join(" ")}`.toLowerCase().includes(t):!0)},[c,a,n]),B=o.useCallback(async t=>{L(!0),f(null);try{const s=await X(t.id);f(s)}catch(s){f(null),r.message.error(s?.message||"加载失败")}finally{L(!1)}},[]),N=t=>{C(t),k(!0),B(t)},P=()=>{k(!1),C(null),f(null)},J=t=>{const s=t.type==="tv"?"TV":"Movie",y=_(t.poster_path,"w342")||_(t.backdrop_path,"w780");return e.jsxs("div",{style:{position:"relative",width:"100%",aspectRatio:"2 / 3",background:"linear-gradient(135deg, #0b1020 0%, #22314a 55%, #2b3b5c 100%)",overflow:"hidden"},children:[y?e.jsx(r.Image,{src:y,alt:t.title||s,preview:!1,wrapperStyle:{width:"100%",height:"100%",display:"block"},style:{width:"100%",height:"100%",objectFit:"cover",display:"block"},fallback:"/logo.svg"}):e.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",color:"rgba(255,255,255,0.7)"},children:e.jsx(h.VideoCameraOutlined,{style:{fontSize:28}})}),e.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(180deg, rgba(0,0,0,0.48) 0%, rgba(0,0,0,0.12) 40%, rgba(0,0,0,0.45) 100%)",pointerEvents:"none"}}),e.jsxs("div",{style:{position:"absolute",top:10,left:10,right:10,display:"flex",justifyContent:"space-between",alignItems:"center",gap:8,pointerEvents:"none"},children:[e.jsx(r.Tag,{color:t.type==="tv"?"geekblue":"gold",style:{marginInlineEnd:0},children:s}),e.jsx(h.VideoCameraOutlined,{style:{fontSize:18,opacity:.9,color:"rgba(255,255,255,0.9)"}})]}),e.jsx("div",{style:{position:"absolute",left:10,bottom:10,width:36,height:36,borderRadius:999,background:"rgba(2,6,23,0.55)",border:"1px solid rgba(255,255,255,0.22)",display:"flex",alignItems:"center",justifyContent:"center",color:"rgba(255,255,255,0.92)",boxShadow:l.boxShadowTertiary,pointerEvents:"none"},children:e.jsx(h.PlayCircleOutlined,{style:{fontSize:20}})})]})};return e.jsxs("div",{style:{height:"100%",display:"flex",flexDirection:"column",background:l.colorBgLayout},children:[e.jsx("div",{style:{padding:14,borderRadius:12,background:l.colorBgContainer,border:`1px solid ${l.colorBorderSecondary}`},children:e.jsxs(r.Flex,{align:"center",justify:"space-between",gap:12,wrap:!0,children:[e.jsxs("div",{style:{minWidth:240},children:[e.jsx(r.Typography.Title,{level:4,style:{margin:0},children:"视频库"}),e.jsx(r.Typography.Text,{type:"secondary",children:`总计: ${b.total} · 电影: ${b.movie} · 电视剧: ${b.tv}`})]}),e.jsxs(r.Space,{size:10,wrap:!0,children:[e.jsx(r.Segmented,{value:c,onChange:t=>d(t),options:[{value:"all",label:"全部"},{value:"movie",label:"电影"},{value:"tv",label:"电视剧"}]}),e.jsx(r.Input,{allowClear:!0,value:n,onChange:t=>i(t.target.value),prefix:e.jsx(h.SearchOutlined,{}),placeholder:"搜索",style:{width:260}}),e.jsx(r.Button,{icon:e.jsx(h.ReloadOutlined,{}),onClick:v,loading:p,children:"刷新"})]})]})}),e.jsx("div",{style:{flex:1,minHeight:0,overflow:"auto",padding:"12px 2px"},children:p?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(210px, 1fr))",gap:12},children:Array.from({length:10}).map((t,s)=>e.jsx(r.Card,{size:"small",style:{borderRadius:12,overflow:"hidden"},cover:e.jsx("div",{style:{width:"100%",aspectRatio:"2 / 3"},children:e.jsx(r.Skeleton.Image,{active:!0,style:{width:"100%",height:"100%"}})}),children:e.jsx(r.Skeleton,{active:!0,paragraph:{rows:2}})},s))}):A.length===0?e.jsx(r.Empty,{description:"暂无数据",style:{marginTop:48}}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(210px, 1fr))",gap:12},children:A.map(t=>e.jsxs(r.Card,{hoverable:!0,size:"small",styles:{body:{padding:10}},style:{borderRadius:12,overflow:"hidden",boxShadow:l.boxShadowTertiary,border:`1px solid ${l.colorBorderSecondary}`},cover:J(t),onClick:()=>N(t),children:[e.jsx(r.Typography.Text,{strong:!0,ellipsis:!0,style:{display:"block"},children:t.title||"--"}),e.jsxs("div",{style:{marginTop:6,display:"flex",gap:8,color:l.colorTextTertiary,fontSize:12},children:[e.jsx("span",{children:t.year||"--"}),t.type==="tv"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"·"}),e.jsx("span",{children:`${t.episodes_count||0} 集`})]})]}),e.jsxs("div",{style:{marginTop:8,display:"flex",flexWrap:"wrap",gap:6},children:[(t.genres||[]).slice(0,3).map(s=>e.jsx(r.Tag,{style:{marginInlineEnd:0},children:s},s)),(t.genres||[]).length>3&&e.jsx(r.Tag,{style:{marginInlineEnd:0},children:`+${(t.genres||[]).length-3}`})]})]},t.id))})}),e.jsx(r.Drawer,{title:q?.title||"详情",open:M,onClose:P,width:"100%",destroyOnClose:!0,styles:{body:{padding:0}},children:z?e.jsx("div",{style:{padding:16},children:e.jsx(r.Skeleton,{active:!0,paragraph:{rows:10}})}):g?e.jsxs("div",{style:{padding:16},children:[e.jsx(r.Typography.Title,{level:4,children:g.tmdb?.detail?.title||g.tmdb?.detail?.name||"--"}),e.jsx(r.Typography.Paragraph,{children:g.tmdb?.detail?.overview||"暂无简介"})]}):e.jsx(r.Empty,{description:"暂无数据",style:{marginTop:48}})})]})};if(!window.__FOXEL_EXTERNALS__)throw console.error("[video-library] Foxel externals not found"),new Error("Foxel externals not found");window.FoxelRegister({mount:(l,n)=>{const i=j.createRoot(l);return i.render(o.createElement(F,n)),()=>i.unmount()},mountApp:(l,n)=>{const i=j.createRoot(l);return i.render(o.createElement(D,n)),()=>i.unmount()}})})(window.__FOXEL_EXTERNALS__.React,window.__FOXEL_EXTERNALS__.ReactDOM,window.__FOXEL_EXTERNALS__.antd,window.__FOXEL_EXTERNALS__.AntdIcons);
